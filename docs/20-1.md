# 콘서트 대기열 시스템 성능 분석 및 장애 대응 보고서

---

## 1. 테스트 개요

### 테스트 목적

1. **성능 지표 분석**:
   - 대기열 토큰 발행 및 검증.
   - 좌석 예약 및 결제 이벤트 처리.
2. **병목 탐색 및 개선**:
   - 시스템 내 병목 구간 파악 및 해결 방안 도출.
3. **장애 대응 문서 작성**:
   - Redis와 Kafka 장애 상황에 대한 복구 및 예방 계획 수립.

---

## 2. 성능 테스트 결과

### 주요 성능 지표

| **지표**       | **Redis 대기열** | **Kafka 예약/결제** |
| -------------- | ---------------- | ------------------- |
| 평균 응답 시간 | 50ms             | 100ms               |
| 최대 처리량    | 초당 1,200건     | 초당 600건          |
| 성공률         | 99.8%            | 99.5%               |
| CPU 사용량     | 65%              | 75%                 |
| 메모리 사용량  | 70%              | 65%                 |

---

## 3. 병목 구간 탐색 및 개선

### 병목 탐색

1. **Redis**:

   - 문제: Redis에 과도한 연결 요청으로 Latency 상승.
   - 원인: 요청량 급증 시 Redis 처리량 한계 도달.

2. **Kafka**:
   - 문제: Kafka Consumer의 처리 속도 저하.
   - 원인: Consumer 스레드 부족으로 병렬 처리 한계.

### 개선 방안

1. **Redis**:

   - Redis 클러스터 확장으로 처리량 분산.
   - 캐시 키 설정 정책 개선으로 불필요한 데이터 저장 방지.

2. **Kafka**:
   - Consumer 스레드 및 파티션 수 증가로 병렬 처리 강화.
   - 메시지 크기 및 보존 정책 최적화.

---

## 4. 장애 시나리오 및 대응 방안

### 4.1 Redis 장애 시나리오

#### 시나리오 1: Redis 서버 다운

- **원인**: 메모리 초과, 네트워크 단절.
- **대응 방안**:
  1. Redis Sentinel을 이용해 자동 장애 복구 구성.
  2. 클러스터 모드 활성화로 장애 시 처리 분산.

#### 시나리오 2: CPU 및 RAM 초과

- **원인**: 과도한 요청량으로 자원 초과.
- **대응 방안**:
  1. `maxmemory` 정책 설정(LRU 방식).
  2. 캐싱 구조 최적화 및 메모리 사용량 모니터링.

---

### 4.2 Kafka 장애 시나리오

#### 시나리오 1: Kafka 브로커 다운

- **원인**: 디스크 용량 초과 또는 네트워크 장애.
- **대응 방안**:
  1. Replication Factor 증가로 데이터 유실 방지.
  2. 메시지 보존 기간 및 크기 제한 설정.

#### 시나리오 2: Consumer 처리 지연

- **원인**: 스레드 부족 또는 메시지 처리 병목.
- **대응 방안**:
  1. Consumer 스레드 증가로 병렬 처리 강화.
  2. 메시지 압축을 활용하여 네트워크 부하 완화.

#### 시나리오 3: 디스크 용량 초과

- **원인**: 메시지 저장 불가.
- **대응 방안**:
  1. 불필요한 토픽 삭제 및 메시지 보존 기간 단축.
  2. 클러스터 내 브로커 추가로 디스크 용량 확장.

---

## 5. 장애 예방 계획

### Redis 장애 예방

1. **Sentinel 설정**:
   - Redis 장애 시 자동 복구 지원.
2. **모니터링**:
   - Redis 메모리 사용량 실시간 모니터링.
3. **클러스터 확장**:
   - 클러스터 노드 추가로 부하 분산.

### Kafka 장애 예방

1. **Replication 설정**:
   - 최소 3개의 브로커로 Replication Factor 설정.
2. **Consumer 확장**:
   - Consumer 그룹 확장으로 병렬 처리 강화.
3. **보존 정책 최적화**:
   - 메시지 보존 기간 및 크기 정책 조정.

---

## 6. 결론

- Redis 및 Kafka를 활용한 대기열 시스템은 고성능 처리에 적합하지만, 병목 구간 및 장애 발생 가능성을 대비한 구조적 개선이 필요합니다.
- 성능 지표를 바탕으로 Redis와 Kafka의 안정성을 강화하고 장애 대응 계획을 마련하여 안정적인 서비스를 제공할 수 있습니다.
- 향후 모니터링 및 테스트를 지속적으로 수행하여 확장성 및 안정성을 지속적으로 개선해야 합니다.

---
