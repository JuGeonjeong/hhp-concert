## 📊 **K6 부하 테스트 비교 보고서**

## **1. 테스트 개요**

이번 성능 테스트에서는 **API의 응답 속도와 처리량을 비교하기 위해 두 가지 환경에서 K6 테스트를 수행**함.

| 테스트 환경                | 설정                                       |
| -------------------------- | ------------------------------------------ |
| **1차 테스트 (쿠키 포함)** | 서버에서 쿠키를 생성하여 클라이언트에 반환 |
| **2차 테스트 (쿠키 제거)** | 쿠키 작업 없이 단순 `return` 값만 응답     |

📌 **테스트 조건**

- **K6 부하 테스트 설정:**
  - 최대 **300명 동시 사용자(VUs)**
  - **5분 30초간 실행**
  - **3단계 부하 증가 (stages 적용)**
- **테스트 항목:**
  - 응답 속도 (`http_req_duration`)
  - 요청 대기 시간 (`http_req_waiting`)
  - 처리량 (`iterations`)
  - 실패율 (`http_req_failed`)

---

## **2. 테스트 결과 비교**

### **📌 1차 테스트 (쿠키 포함)**

- **평균 응답 시간:** 🟠 **1.43초**
- **최대 응답 시간:** ❌ **28.42초**
- **p90 응답 시간:** 🟠 **4.18초**
- **p95 응답 시간:** ❌ **5.75초**
- **총 요청 수:** 🔵 **25,166**
- **성공률:** 🟠 **79.01% (50332 요청 중 39768 성공)**
- **실패율:** ❌ **약 21% (500ms 이상 응답 시간 초과)**

📌 **분석:**  
✅ 요청은 정상적으로 처리되었지만, **쿠키 생성 및 전송 과정에서 응답 속도가 느려지는 경향**을 보임.  
❌ 최대 응답 시간이 28.42초로 너무 길어져, 일부 요청이 지연됨.  
⚡ **성공률이 79%로 낮으며, 500ms 이상 걸리는 요청이 많음.**

---

### **📌 2차 테스트 (쿠키 제거)**

- **평균 응답 시간:** 🟢 **5.47ms**
- **최대 응답 시간:** 🟢 **129.42ms**
- **p90 응답 시간:** 🟢 **9.74ms**
- **p95 응답 시간:** 🟢 **12.77ms**
- **총 요청 수:** 🔵 **59,905**
- **성공률:** 🟢 **100% (119810 요청 중 119810 성공)**
- **실패율:** 🟢 **0.00%**

📌 **분석:**  
✅ **쿠키 작업을 제거하면서 API 응답 속도가 1.43초 → 5.47ms로 대폭 개선됨** 🚀  
✅ **p90 기준 응답 속도도 4.18초 → 9.74ms로 대폭 단축됨**  
✅ **실패율이 0%로 유지되며, 부하를 잘 견딤**

---

## **3. 비교 분석 요약**

| 항목               | 1차 테스트 (쿠키 포함)  | 2차 테스트 (쿠키 제거) | 차이점                                          |
| ------------------ | ----------------------- | ---------------------- | ----------------------------------------------- |
| **평균 응답 시간** | 🟠 **1.43초**           | 🟢 **5.47ms**          | 🚀 **쿠키 제거 후 261배 개선**                  |
| **최대 응답 시간** | ❌ **28.42초**          | 🟢 **129.42ms**        | 🚀 **쿠키 제거 후 최악의 응답 시간 99.5% 감소** |
| **p90 응답 시간**  | 🟠 **4.18초**           | 🟢 **9.74ms**          | 🚀 **90% 요청의 응답 속도 대폭 개선**           |
| **p95 응답 시간**  | ❌ **5.75초**           | 🟢 **12.77ms**         | 🚀 **95% 요청 응답 속도 대폭 개선**             |
| **총 요청 처리량** | 🔵 **25,166**           | 🔵 **59,905**          | 🚀 **처리량 2.38배 증가**                       |
| **성공률**         | 🟠 **79.01%**           | 🟢 **100%**            | 🚀 **성공률 21% 증가**                          |
| **실패율**         | ❌ **21% (500ms 초과)** | 🟢 **0.00%**           | 🚀 **실패율 0% 유지**                           |

📌 **결론:**  
✅ **쿠키 생성 작업이 API 응답 속도를 현저히 늦추는 원인이었음**  
✅ **쿠키를 제거하면서 응답 속도가 **1.43초 → 5.47ms**로 대폭 감소**  
✅ **총 요청 처리량이 2배 이상 증가하면서 서버 부하가 훨씬 개선됨**

---

## **4. 최적화 방향**

### **1) 쿠키 생성 최적화**

- 쿠키 생성이 필요할 경우, **JWT 토큰 방식으로 변경하여 클라이언트에서 처리**
- 서버 측에서 쿠키를 만들고 반환하는 과정이 병목이 될 가능성이 높음

### **2) 데이터베이스 또는 캐시 활용**

- **Redis 같은 캐시를 활용**하여 사용자 세션을 관리하면 **서버 부담 감소 가능**

### **3) 부하 테스트 확장**

- 현재 300명까지는 잘 처리되므로, **500명, 1000명까지 테스트를 늘려 최대 처리 한계 확인 필요**

---

## **5. 최종 결론**

- **쿠키 제거 후 API 응답 속도 & 처리량이 대폭 개선됨!**
- **서버가 300명 동시 접속을 문제없이 처리 가능하며, 추가적인 확장 테스트가 필요함**
- **쿠키 사용이 반드시 필요하다면, JWT 토큰 활용 또는 캐싱을 고려해야 함**

#### 즉, 쿠키 생성 과정이 성능 저하의 주요 원인이었으며, 이를 제거함으로써 API 성능이 극적으로 개선

---

#### 1차 테스트

![서버에서 쿠시 생성시.png](/doc/image/k6-run-cookie.png)

#### 2차 테스트

![서버에서 쿠시 생성시.png](/doc/image/k6-run-not-cookie.png)
